<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../../../../xslt/source-code.xsl"?>
<classDetails className="net.sf.sanity4j.workflow.JavaVersionCheck" pathToRoot="../../../../" qaVersion="1.1.1" runDate="Thu Aug 21 12:46:30 EST 2014">
<summary high="0" significant="0" moderate="0" low="0" info="1" lineCoverage="0" branchCoverage="0" quality="100"/>
<source>
<line>package net.sf.sanity4j.workflow; </line>
<line/>
<line>import java.io.ByteArrayOutputStream;</line>
<line/>
<line>import net.sf.sanity4j.util.ExternalProcessRunner;</line>
<line>import net.sf.sanity4j.util.QAException;</line>
<line>import net.sf.sanity4j.util.QaLogger;</line>
<line/>
<line/>
<line>/** </line>
<line> * Checks the java version that the tools will be run under.</line>
<line> * The version is checked by running &quot;java -version&quot; and </line>
<line> * parsing the output. Currently, 1.3 through 1.5 VMs from</line>
<line> * various vendors seem to have a common first line:</line>
<line> *      java version &quot;x.y.z&quot; </line>
<line> * </line>
<line> * @author Yiannis Paschalidis</line>
<line> * @since Sanity4J 1.0</line>
<line> */</line>
<line>public class JavaVersionCheck implements WorkUnit</line>
<line>{</line>
<line>    /** The java runtime to check. */</line>
<line>    private final String javaRuntime;</line>
<line/>
<line>    /**</line>
<line>     * Creates a JavaVersionCheck.</line>
<line>     * @param config the current QA run's configuration.</line>
<line>     */</line>
<line>    public JavaVersionCheck(final QAConfig config)</line>
<line covered="no">    {</line>
<line covered="no">        this.javaRuntime = config.getJavaRuntime();</line>
<line covered="no">    }</line>
<line/>
<line>    /** {@inheritDoc} */</line>
<line>    public String getDescription()</line>
<line>    {</line>
<line covered="no">        return &quot;Checking java version&quot;;</line>
<line>    }</line>
<line/>
<line>    /**</line>
<line>     * Executes the java runtime to obtain the version number.</line>
<line>     */</line>
<line>    public void run()</line>
<line>    {</line>
<line covered="no">        String[] cmdLine = new String[]</line>
<line>        {</line>
<line>            javaRuntime,</line>
<line>            &quot;-version&quot;</line>
<line>        };</line>
<line/>
<line covered="no">        ByteArrayOutputStream baos = new ByteArrayOutputStream();</line>
<line covered="no">        ExternalProcessRunner.runProcess(cmdLine, System.out, baos);</line>
<line/>
<line sev="0" covered="no"><diag id="351"/>        String[] output = baos.toString().split(&quot;[\n\r]&quot;);</line>
<line covered="no">        String javaVersion = output[0].replaceAll(&quot;.*\&quot;(.*)\&quot;.*&quot;, &quot;$1&quot;);</line>
<line/>
<line covered="no">        QaLogger.getInstance().info(&quot;Java version: &quot; + javaVersion);</line>
<line/>
<line covered="no">        if (&quot;1.5&quot;.compareTo(javaVersion) &gt; 0)</line>
<line>        {</line>
<line covered="no">            String msg = &quot;The QA tools require java 1.5 or later to Run, current java version is &quot; + javaVersion;</line>
<line covered="no">            throw new QAException(msg);</line>
<line>        }</line>
<line covered="no">    }</line>
<line>}</line>
</source>
<diags first="false">
<diag id="351" sev="0" tool="Findbugs" rule="DM_DEFAULT_ENCODING">Found reliance on default encoding in net.sf.sanity4j.workflow.JavaVersionCheck.run(): java.io.ByteArrayOutputStream.toString()</diag>
</diags>
</classDetails>
