<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../../../../xslt/source-code.xsl"?>
<classDetails className="net.sf.sanity4j.util.PipeInputThread_Test" pathToRoot="../../../../" qaVersion="1.1.1" runDate="Thu Aug 21 12:46:30 EST 2014">
<summary high="0" significant="0" moderate="0" low="0" info="0" quality="100"/>
<source>
<line>package net.sf.sanity4j.util; </line>
<line/>
<line>import java.io.ByteArrayInputStream;</line>
<line>import java.io.ByteArrayOutputStream;</line>
<line>import java.util.Arrays;</line>
<line>import java.util.Random;</line>
<line/>
<line>import junit.framework.TestCase;</line>
<line/>
<line>/** </line>
<line> * PipeInputStream_Test - unit test for PipeInputStream.</line>
<line> * </line>
<line> * @author Yiannis Paschalidis</line>
<line> * @since Sanity4J 1.0</line>
<line> */</line>
<line>public class PipeInputThread_Test extends TestCase</line>
<line>{</line>
<line>    /** Should complete in far less than 1 second. */</line>
<line>    private static final int SLEEP_TIME = 100;</line>
<line>    /** Retry count. */</line>
<line>    private static final int RETRY_COUNT = 10;</line>
<line/>
<line>    public void testPipeInput()</line>
<line>    {</line>
<line>        // Test with a fair amount of data that would </line>
<line>        // just overflow most typical buffer lengths </line>
<line>        byte[] dataIn = new byte[65536 + 1];</line>
<line>        new Random().nextBytes(dataIn);</line>
<line/>
<line>        ByteArrayInputStream bais = new ByteArrayInputStream(dataIn);</line>
<line>        ByteArrayOutputStream baos = new ByteArrayOutputStream();</line>
<line/>
<line>        PipeInputThread pipe = new PipeInputThread(bais, baos);</line>
<line>        pipe.start();</line>
<line/>
<line>        // Should complete in far less than a second...</line>
<line>        for (int count = 1; count &lt; RETRY_COUNT; count++)</line>
<line>        {</line>
<line>            try</line>
<line>            {</line>
<line>                Thread.sleep(SLEEP_TIME);</line>
<line/>
<line>                if (!pipe.isRunning())</line>
<line>                {</line>
<line>                    break;</line>
<line>                }</line>
<line>            }</line>
<line>            catch (InterruptedException e)</line>
<line>            {</line>
<line>                fail(&quot;Interrupted&quot;);</line>
<line>            }</line>
<line>        }</line>
<line/>
<line>        byte[] dataOut = baos.toByteArray();</line>
<line/>
<line>        assertEquals(&quot;Incorrect amount of data read&quot;, dataIn.length, dataOut.length);</line>
<line>        assertTrue(&quot;Incorrect data read&quot;, Arrays.equals(dataIn, dataOut));</line>
<line>    }</line>
<line>}</line>
</source>
</classDetails>
