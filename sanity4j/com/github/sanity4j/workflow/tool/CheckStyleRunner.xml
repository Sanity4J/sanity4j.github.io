<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../../../../../xslt/source-code.xsl"?>
<classDetails className="com.github.sanity4j.workflow.tool.CheckStyleRunner" pathToRoot="../../../../../" qaVersion="1.8.1" runDate="Mon May 29 13:41:29 AEST 2017">
<summary high="0" significant="1" moderate="0" low="0" info="0" quality="77"/>
<source>
<line>package com.github.sanity4j.workflow.tool;</line>
<line/>
<line>import java.io.ByteArrayOutputStream;</line>
<line>import java.io.File;</line>
<line/>
<line>import com.github.sanity4j.util.ExternalProcessRunner;</line>
<line>import com.github.sanity4j.util.FileUtil;</line>
<line>import com.github.sanity4j.util.QAException;</line>
<line>import com.github.sanity4j.util.QaLogger;</line>
<line>import com.github.sanity4j.util.QaUtil;</line>
<line>import com.github.sanity4j.util.Tool;</line>
<line/>
<line>/**</line>
<line> * CheckStyleRunner - a work unit that runs CheckStyle.</line>
<line> *</line>
<line> * @author Yiannis Paschalidis</line>
<line> * @since Sanity4J 1.0</line>
<line> */</line>
<line>public class CheckStyleRunner extends AbstractToolRunner</line>
<line>{</line>
<line>    /**</line>
<line>     * Creates a CheckStyleRunner.</line>
<line>     */</line>
<line>    public CheckStyleRunner()</line>
<line>    {</line>
<line>        super(Tool.CHECKSTYLE);</line>
<line>    }</line>
<line/>
<line>    /**</line>
<line>     * Runs CheckStyle.</line>
<line>     * @param commandLine the CheckStyle command line.</line>
<line>     */</line>
<line>    protected void runTool(final String commandLine)</line>
<line>    {</line>
<line>        File resultFile = getConfig().getToolResultFile(Tool.CHECKSTYLE);</line>
<line>        FileUtil.createDir(resultFile.getParentFile().getPath());</line>
<line/>
<line>        // Run the process</line>
<line>        ByteArrayOutputStream stdout = null; </line>
<line>        ByteArrayOutputStream stderr = null; </line>
<line/>
<line>        try</line>
<line>        {</line>
<line>            stdout = new ByteArrayOutputStream();</line>
<line>            stderr = new ByteArrayOutputStream();</line>
<line/>
<line>            ExternalProcessRunner.runProcess(commandLine, stdout, stderr);</line>
<line/>
<line>            String stdoutString = new String(stdout.toByteArray());</line>
<line/>
<line>            if (FileUtil.hasValue(stdoutString))</line>
<line>            {</line>
<line>                QaLogger.getInstance().info(stdoutString);</line>
<line>            }</line>
<line/>
<line>            String stderrString = new String(stderr.toByteArray());</line>
<line/>
<line>            if (FileUtil.hasValue(stderrString))</line>
<line>            {</line>
<line>                QaLogger.getInstance().error(stderrString);</line>
<line>            }</line>
<line>        }</line>
<line>        finally</line>
<line>        {</line>
<line>            QaUtil.safeClose(stdout);</line>
<line>            QaUtil.safeClose(stderr);</line>
<line>        }</line>
<line/>
<line>        // The checkstyle result is the number of errors found, so</line>
<line>        // the only way to determine if it succeeded is to check if</line>
<line>        // the output file has been created successfully</line>
<line>        if (!resultFile.exists() || resultFile.length() == 0)</line>
<line>        {</line>
<line>            String out = new String(stdout.toByteArray());</line>
<line sev="3"><diag id="319"/>            String err = new String(stderr.toByteArray());</line>
<line>            throw new QAException(&quot;Checkstyle Command [&quot; + commandLine + &quot;] failed to generate output: [&quot; + out  + &quot;] [&quot; + err + &quot;]&quot;);</line>
<line>        }</line>
<line>    }</line>
<line/>
<line>    /**</line>
<line>     * @return the description of this WorkUnit</line>
<line>     */</line>
<line>    public String getDescription()</line>
<line>    {</line>
<line>        return &quot;Running CheckStyle&quot;;</line>
<line>    }</line>
<line>}</line>
</source>
<diags first="false">
<diag id="319" sev="3" tool="Findbugs" rule="DM_DEFAULT_ENCODING">Found reliance on default encoding in com.github.sanity4j.workflow.tool.CheckStyleRunner.runTool(String): new String(byte[])</diag>
</diags>
</classDetails>
